/**
* @name BetterScreenshare
* @version 0.0.1
* @author Phil
* @description With this plugin you can customize your resolution, framerate, bitrate and more for your screenshare!
* @authorId 305288513941667851
* @source https://github.com/philhk/better-discord-screenshare-plugin
 */
var Rt=Object.defineProperty;var Lt=(A,I,w)=>I in A?Rt(A,I,{enumerable:!0,configurable:!0,writable:!0,value:w}):A[I]=w;var R=(A,I,w)=>(Lt(A,typeof I!="symbol"?I+"":I,w),w);/*!
 * MIT License
 * 
 * Copyright (c) 2023 Phil
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */(function(A){var He;"use strict";let I=null;const w=()=>{if(I)return I;throw Error("Accessing meta before initialization")},We=e=>{I=e},Ue=e=>BdApi.Data.load(w().name,e),Ve=(e,t)=>BdApi.Data.save(w().name,e,t),ye=(...e)=>t=>t instanceof Object&&e.every(n=>n in t),Y=(...e)=>t=>t instanceof Object&&t.prototype instanceof Object&&e.every(n=>n in t.prototype),K=(...e)=>t=>{var n,r;for(;t instanceof Object&&"$$typeof"in t;)t=t.render??t.type;if(t instanceof Function){const o=t.toString(),s=(r=(n=t.prototype)==null?void 0:n.render)==null?void 0:r.toString();return e.every(d=>typeof d=="string"?o.includes(d)||(s==null?void 0:s.includes(d)):d(o)||s&&d(s))}else return!1},Ne=(e,t)=>{const n=new Map(Object.entries(t));return new Proxy(e,{get(r,o){return r[n.get(o)??o]},set(r,o,s){return r[n.get(o)??o]=s,!0},deleteProperty(r,o){return delete r[n.get(o)??o],n.delete(o),!0},has(r,o){return n.has(o)||o in r},ownKeys(){return[...n.keys(),...Object.keys(e)]},getOwnPropertyDescriptor(r,o){return Object.getOwnPropertyDescriptor(r,n.get(o)??o)},defineProperty(r,o,s){return Object.defineProperty(r,n.get(o)??o,s),!0}})},z=(e,{resolve:t=!0,entries:n=!1}={})=>BdApi.Webpack.getModule(e,{defaultExport:t,searchExports:n}),W=(e,t)=>z(ye(...e),t),X=(e,t)=>z(K(...e),t),_e=(e,t,n=!1)=>{const r=t??Object.keys(e),o=z(s=>s instanceof Object&&s!==window&&r.every(d=>Object.values(s).some(m=>e[d](m))));return n?Ne(o,Object.fromEntries(Object.entries(e).map(([s,d])=>{var m;return[s,(m=Object.entries(o??{}).find(([,v])=>d(v)))==null?void 0:m[0]]}))):Object.fromEntries(Object.entries(e).map(([s,d])=>[s,Object.values(o??{}).find(m=>d(m))]))};new AbortController;const Ke="#3a71c1",ze=(e,...t)=>e(`%c[${w().name}] %c${w().version?`(v${w().version})`:""}`,`color: ${Ke}; font-weight: 700;`,"color: #666; font-size: .8em;",...t),Z=(...e)=>ze(console.log,...e),Ge=(e,t,n,r,o)=>{const s=t==null?void 0:t[n];if(!(s instanceof Function))throw TypeError(`patch target ${s} is not a function`);const d=BdApi.Patcher[e](w().name,t,n,o.once?(...m)=>{const v=r(d,s,...m);return d(),v}:(...m)=>r(d,s,...m));return o.silent||Z(`Patched ${o.name??String(n)}`),d},Oe=(e,t,n,r={})=>Ge("after",e,t,(o,s,d,m,v)=>n({cancel:o,original:s,context:d,args:m,result:v}),r);let q=[];const ke=()=>{if(q.length+BdApi.Patcher.getPatchesByCaller(w().name).length>0){for(const e of q)e();q=[],BdApi.Patcher.unpatchAll(w().name),Z("Unpatched all")}},j=_e({default:ye("Store","connectStores"),Dispatcher:Y("dispatch"),Store:Y("emitChange"),BatchedStoreListener:Y("attach","detach"),useStateFromStores:K("useStateFromStores")},["Store","Dispatcher","useStateFromStores"]),{React:G}=BdApi,{ReactDOM:ee}=BdApi;BdApi.ContextMenu,_e({Select:K(".renderOptionLabel",".renderOptionValue"),SingleSelect:K("select:","onChange:")},["Select"]),X(["pendingReply"]),G==null||G.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,(He=ee==null?void 0:ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)==null||He.Events;const Qe=(e,t)=>{var r;const n=[e].flat();for(;n.length!==0;){const o=n.shift();if(t(o))return o;(r=o==null?void 0:o.props)!=null&&r.children&&n.push(...[o.props.children].flat())}return null};class It extends j.Store{constructor(n,r){super(new j.Dispatcher,{update:()=>{for(const o of this.listeners)o(this.current)}});R(this,"defaults");R(this,"current");R(this,"onLoad");R(this,"listeners");this.listeners=new Set,this.defaults=n,this.onLoad=r}load(){var n;this.current={...this.defaults,...Ue("settings")},(n=this.onLoad)==null||n.call(this),this._dispatch(!1)}_dispatch(n){this._dispatcher.dispatch({type:"update"}),n&&Ve("settings",this.current)}update(n){Object.assign(this.current,typeof n=="function"?n(this.current):n),this._dispatch(!0)}reset(){this.current={...this.defaults},this._dispatch(!0)}delete(...n){for(const r of n)delete this.current[r];this._dispatch(!0)}useCurrent(){return j.useStateFromStores([this],()=>this.current,void 0,()=>!1)}useSelector(n,r,o){return j.useStateFromStores([this],()=>n(this.current),r,o)}useState(){return j.useStateFromStores([this],()=>[this.current,n=>this.update(n)])}useStateWithDefaults(){return j.useStateFromStores([this],()=>[this.current,this.defaults,n=>this.update(n)])}useListener(n,r){G.useEffect(()=>(this.addListener(n),()=>this.removeListener(n)),r??[n])}addListener(n){return this.listeners.add(n),n}removeListener(n){this.listeners.delete(n)}removeAllListeners(){this.listeners.clear()}}const Je=(()=>({name:"BetterScreenshare",version:"0.0.1",author:"Phil",description:"With this plugin you can customize your resolution, framerate, bitrate and more for your screenshare!",authorId:"305288513941667851",source:"https://github.com/philhk/better-discord-screenshare-plugin"}))();class $e{}class k{static addListener(t,n,r,o){t[n](r,o);const s={emitter:t,event:r,fn:o};return this.events.push(s),()=>this.removeListener(s)}static removeListener(t){t.emitter.removeListener(t.event,t.fn),this.events=this.events.filter(n=>n!==t)}static removeAllListeners(){this.events.forEach(t=>t.emitter.removeListener(t.event,t.fn)),this.events=[]}}R(k,"events",[]);const Ae=e=>{if(typeof e=="object"&&e!==null){if(typeof Object.getPrototypeOf=="function"){const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}return Object.prototype.toString.call(e)==="[object Object]"}return!1},B=(...e)=>e.reduce((t,n)=>{if(Array.isArray(n))throw new TypeError("Arguments provided to ts-deepmerge must be objects, not arrays.");return Object.keys(n).forEach(r=>{["__proto__","constructor","prototype"].includes(r)||(Array.isArray(t[r])&&Array.isArray(n[r])?t[r]=B.options.mergeArrays?Array.from(new Set(t[r].concat(n[r]))):n[r]:Ae(t[r])&&Ae(n[r])?t[r]=B(t[r],n[r]):t[r]=n[r])}),t},{}),be={mergeArrays:!0};B.options=be,B.withOptions=(e,...t)=>{B.options=Object.assign({mergeArrays:!0},e);const n=B(...t);return B.options=be,n};const we={get MediaEngineStore(){return W(["getAttenuateWhileSpeakingOthers"])},get StreamStore(){return W(["getAllActiveStreams","getStreamForUser"])}},Ce={get Utils(){return W(["getPidFromDesktopSource"])},get Dispatcher(){return W(["isDispatching","subscribe"])}},te={get Dropdown(){return X(["value","onChange","serialize","isSelected"],{entries:!0})},get TextInput(){return z(e=>{var t;return((t=e==null?void 0:e.defaultProps)==null?void 0:t.type)==="text"},{entries:!0})},get Location(){return X(["_loadDate","getLocation","mergeLocation"])}},Ye={get Text(){return W(["h5"])}},Xe=te.Dropdown,Re=te.TextInput,Ze=Re.Sizes,qe=te.Location,et=Ye.Text,tt=Ce.Utils,rt=Ce.Dispatcher,re=we.MediaEngineStore,nt=we.StreamStore,Le=e=>{let t;const n=new Set,r=(v,l)=>{const f=typeof v=="function"?v(t):v;if(!Object.is(f,t)){const c=t;t=l??typeof f!="object"?f:Object.assign({},t,f),n.forEach(p=>p(t,c))}},o=()=>t,m={setState:r,getState:o,subscribe:v=>(n.add(v),()=>n.delete(v)),destroy:()=>{({BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}};return t=e(r,o,m),m},ot=e=>e?Le(e):Le;function st(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ne={},it={get exports(){return ne},set exports(e){ne=e}},oe={},Q={},at={get exports(){return Q},set exports(e){Q=e}},se={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ie;function ct(){if(Ie)return se;Ie=1;var e=A;function t(c,p){return c===p&&(c!==0||1/c===1/p)||c!==c&&p!==p}var n=typeof Object.is=="function"?Object.is:t,r=e.useState,o=e.useEffect,s=e.useLayoutEffect,d=e.useDebugValue;function m(c,p){var h=p(),g=r({inst:{value:h,getSnapshot:p}}),u=g[0].inst,a=g[1];return s(function(){u.value=h,u.getSnapshot=p,v(u)&&a({inst:u})},[c,h,p]),o(function(){return v(u)&&a({inst:u}),c(function(){v(u)&&a({inst:u})})},[c]),d(h),h}function v(c){var p=c.getSnapshot;c=c.value;try{var h=p();return!n(c,h)}catch{return!0}}function l(c,p){return p()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:m;return se.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:f,se}var ie={};/**
 * @license React
 * use-sync-external-store-shim.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var De;function ut(){return De||(De=1,process.env.NODE_ENV!=="production"&&function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=A,t=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function n(y){{for(var E=arguments.length,b=new Array(E>1?E-1:0),i=1;i<E;i++)b[i-1]=arguments[i];r("error",y,b)}}function r(y,E,b){{var i=t.ReactDebugCurrentFrame,O=i.getStackAddendum();O!==""&&(E+="%s",b=b.concat([O]));var D=b.map(function(C){return String(C)});D.unshift("Warning: "+E),Function.prototype.apply.call(console[y],console,D)}}function o(y,E){return y===E&&(y!==0||1/y===1/E)||y!==y&&E!==E}var s=typeof Object.is=="function"?Object.is:o,d=e.useState,m=e.useEffect,v=e.useLayoutEffect,l=e.useDebugValue,f=!1,c=!1;function p(y,E,b){f||e.startTransition!==void 0&&(f=!0,n("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var i=E();if(!c){var O=E();s(i,O)||(n("The result of getSnapshot should be cached to avoid an infinite loop"),c=!0)}var D=d({inst:{value:i,getSnapshot:E}}),C=D[0].inst,V=D[1];return v(function(){C.value=i,C.getSnapshot=E,h(C)&&V({inst:C})},[y,i,E]),m(function(){h(C)&&V({inst:C});var me=function(){h(C)&&V({inst:C})};return y(me)},[y]),l(i),i}function h(y){var E=y.getSnapshot,b=y.value;try{var i=E();return!s(b,i)}catch{return!0}}function g(y,E,b){return E()}var u=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",a=!u,S=a?g:p,_=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:S;ie.useSyncExternalStore=_,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()),ie}var Be;function Te(){return Be||(Be=1,function(e){process.env.NODE_ENV==="production"?e.exports=ct():e.exports=ut()}(at)),Q}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xe;function lt(){if(xe)return oe;xe=1;var e=A,t=Te();function n(l,f){return l===f&&(l!==0||1/l===1/f)||l!==l&&f!==f}var r=typeof Object.is=="function"?Object.is:n,o=t.useSyncExternalStore,s=e.useRef,d=e.useEffect,m=e.useMemo,v=e.useDebugValue;return oe.useSyncExternalStoreWithSelector=function(l,f,c,p,h){var g=s(null);if(g.current===null){var u={hasValue:!1,value:null};g.current=u}else u=g.current;g=m(function(){function S(i){if(!_){if(_=!0,y=i,i=p(i),h!==void 0&&u.hasValue){var O=u.value;if(h(O,i))return E=O}return E=i}if(O=E,r(y,i))return O;var D=p(i);return h!==void 0&&h(O,D)?O:(y=i,E=D)}var _=!1,y,E,b=c===void 0?null:c;return[function(){return S(f())},b===null?void 0:function(){return S(b())}]},[f,c,p,h]);var a=o(l,g[0],g[1]);return d(function(){u.hasValue=!0,u.value=a},[a]),v(a),a},oe}var ae={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pe;function dt(){return Pe||(Pe=1,process.env.NODE_ENV!=="production"&&function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=A,t=Te();function n(f,c){return f===c&&(f!==0||1/f===1/c)||f!==f&&c!==c}var r=typeof Object.is=="function"?Object.is:n,o=t.useSyncExternalStore,s=e.useRef,d=e.useEffect,m=e.useMemo,v=e.useDebugValue;function l(f,c,p,h,g){var u=s(null),a;u.current===null?(a={hasValue:!1,value:null},u.current=a):a=u.current;var S=m(function(){var b=!1,i,O,D=function(N){if(!b){b=!0,i=N;var Se=h(N);if(g!==void 0&&a.hasValue){var ve=a.value;if(g(ve,Se))return O=ve,ve}return O=Se,Se}var Ct=i,ge=O;if(r(Ct,N))return ge;var Ee=h(N);return g!==void 0&&g(ge,Ee)?ge:(i=N,O=Ee,Ee)},C=p===void 0?null:p,V=function(){return D(c())},me=C===null?void 0:function(){return D(C())};return[V,me]},[c,p,h,g]),_=S[0],y=S[1],E=o(f,_,y);return d(function(){a.hasValue=!0,a.value=E},[E]),v(E),E}ae.useSyncExternalStoreWithSelector=l,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()),ae}(function(e){process.env.NODE_ENV==="production"?e.exports=lt():e.exports=dt()})(it);const ht=st(ne),{useSyncExternalStoreWithSelector:pt}=ht;function ft(e,t=e.getState,n){const r=pt(e.subscribe,e.getState,e.getServerState||e.getState,t,n);return A.useDebugValue(r),r}const Me=e=>{({BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?ot(e):e,n=(r,o)=>ft(t,r,o);return Object.assign(n,t),n},mt=e=>e?Me(e):Me;function Fe(e){let t;try{t=e()}catch{return}return{getItem:r=>{var o;const s=m=>m===null?null:JSON.parse(m),d=(o=t.getItem(r))!=null?o:null;return d instanceof Promise?d.then(s):s(d)},setItem:(r,o)=>t.setItem(r,JSON.stringify(o)),removeItem:r=>t.removeItem(r)}}const U=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then(r){return U(r)(n)},catch(r){return this}}}catch(n){return{then(r){return this},catch(r){return U(r)(n)}}}},St=(e,t)=>(n,r,o)=>{let s={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:a=>a,version:0,merge:(a,S)=>({...S,...a}),...t},d=!1;const m=new Set,v=new Set;let l;try{l=s.getStorage()}catch{}if(!l)return e((...a)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),n(...a)},r,o);const f=U(s.serialize),c=()=>{const a=s.partialize({...r()});let S;const _=f({state:a,version:s.version}).then(y=>l.setItem(s.name,y)).catch(y=>{S=y});if(S)throw S;return _},p=o.setState;o.setState=(a,S)=>{p(a,S),c()};const h=e((...a)=>{n(...a),c()},r,o);let g;const u=()=>{var a;if(!l)return;d=!1,m.forEach(_=>_(r()));const S=((a=s.onRehydrateStorage)==null?void 0:a.call(s,r()))||void 0;return U(l.getItem.bind(l))(s.name).then(_=>{if(_)return s.deserialize(_)}).then(_=>{if(_)if(typeof _.version=="number"&&_.version!==s.version){if(s.migrate)return s.migrate(_.state,_.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return _.state}).then(_=>{var y;return g=s.merge(_,(y=r())!=null?y:h),n(g,!0),c()}).then(()=>{S==null||S(g,void 0),d=!0,v.forEach(_=>_(g))}).catch(_=>{S==null||S(void 0,_)})};return o.persist={setOptions:a=>{s={...s,...a},a.getStorage&&(l=a.getStorage())},clearStorage:()=>{l==null||l.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>u(),hasHydrated:()=>d,onHydrate:a=>(m.add(a),()=>{m.delete(a)}),onFinishHydration:a=>(v.add(a),()=>{v.delete(a)})},u(),g||h},vt=(e,t)=>(n,r,o)=>{let s={storage:Fe(()=>localStorage),partialize:u=>u,version:0,merge:(u,a)=>({...a,...u}),...t},d=!1;const m=new Set,v=new Set;let l=s.storage;if(!l)return e((...u)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),n(...u)},r,o);const f=()=>{const u=s.partialize({...r()});return l.setItem(s.name,{state:u,version:s.version})},c=o.setState;o.setState=(u,a)=>{c(u,a),f()};const p=e((...u)=>{n(...u),f()},r,o);let h;const g=()=>{var u;if(!l)return;d=!1,m.forEach(S=>S(r()));const a=((u=s.onRehydrateStorage)==null?void 0:u.call(s,r()))||void 0;return U(l.getItem.bind(l))(s.name).then(S=>{if(S)if(typeof S.version=="number"&&S.version!==s.version){if(s.migrate)return s.migrate(S.state,S.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return S.state}).then(S=>{var _;return h=s.merge(S,(_=r())!=null?_:p),n(h,!0),f()}).then(()=>{a==null||a(h,void 0),d=!0,v.forEach(S=>S(h))}).catch(S=>{a==null||a(void 0,S)})};return o.persist={setOptions:u=>{s={...s,...u},u.storage&&(l=u.storage)},clearStorage:()=>{l==null||l.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>g(),hasHydrated:()=>d,onHydrate:u=>(m.add(u),()=>{m.delete(u)}),onFinishHydration:u=>(v.add(u),()=>{v.delete(u)})},g(),h||p},gt=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?(({BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),St(e,t)):vt(e,t);function J(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function Et(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=J(n);return(o,s)=>r.then(d=>s(d.transaction(t,o).objectStore(t)))}let ce;function ue(){return ce||(ce=Et("keyval-store","keyval")),ce}function yt(e,t=ue()){return t("readonly",n=>J(n.get(e)))}function _t(e,t,n=ue()){return n("readwrite",r=>(r.put(t,e),J(r.transaction)))}function Ot(e,t=ue()){return t("readwrite",n=>(n.delete(e),J(n.transaction)))}const At={getItem:async e=>await yt(e)||null,setItem:async(e,t)=>{await _t(e,t)},removeItem:async e=>{await Ot(e)}},le=e=>e*1e3,$=(e,t)=>{if(!e)return[];const n=[];return Object.entries(e).filter(([r,o])=>typeof o=="function").forEach(([r,o])=>(!(t!=null&&t.filter)||t.filter([r,o]))&&n.push(Oe(e,r,s=>{Z(`${t!=null&&t.name?`[${t.name}] `:""}[${r}]`,s)}))),t!=null&&t.searchProtos?[...n,...$(e.__proto__,t)]:n},T=(e,t)=>{const n=parseInt(e);t(n)},x=e=>typeof e=="number"?e:e?parseInt(e):void 0,L={bitrate:{minimum:1e3,target:2500,maximum:5e3},encode:{framerate:60,height:1080,width:1920},capture:{framerate:60,height:1080,width:1920},audioCodec:"OPUS",videoCodec:"H264"},je=mt(gt((e,t)=>({screenshare:{bitrate:{getMaximum:()=>x(t().screenshare.bitrate.maximum)||L.bitrate.maximum,getMinimum:()=>x(t().screenshare.bitrate.minimum)||L.bitrate.minimum,getTarget:()=>x(t().screenshare.bitrate.target)||L.bitrate.target,setMaximum:n=>t().customSet(r=>(r.screenshare.bitrate.maximum=n,r)),setMinimum:n=>t().customSet(r=>(r.screenshare.bitrate.minimum=n,r)),setTarget:n=>t().customSet(r=>(r.screenshare.bitrate.target=n,r))},encode:{getFramerate:()=>x(t().screenshare.encode.framerate)||L.encode.framerate,getWidth:()=>x(t().screenshare.encode.width)||L.encode.width,getHeight:()=>x(t().screenshare.encode.height)||L.encode.height,setFramerate:n=>t().customSet(r=>(r.screenshare.encode.framerate=n,r)),setWidth:n=>t().customSet(r=>(r.screenshare.encode.width=n,r)),setHeight:n=>t().customSet(r=>(r.screenshare.encode.height=n,r))},capture:{getFramerate:()=>x(t().screenshare.capture.framerate)||L.capture.framerate,getWidth:()=>x(t().screenshare.capture.width)||L.capture.width,getHeight:()=>x(t().screenshare.capture.height)||L.capture.height,setFramerate:n=>t().customSet(r=>(r.screenshare.capture.framerate=n,r)),setWidth:n=>t().customSet(r=>(r.screenshare.capture.width=n,r)),setHeight:n=>t().customSet(r=>(r.screenshare.capture.height=n,r))},setAudioCodec:n=>t().customSet(r=>(r.screenshare.audioCodec=n,r)),setVideoCodec:n=>t().customSet(r=>(r.screenshare.videoCodec=n,r)),setAudioSource:n=>t().customSet(r=>(r.screenshare.audioSource=n,r)),setKeyframeInterval:n=>t().customSet(r=>(r.screenshare.keyframeInterval=n,r)),getAudioCodec:()=>t().screenshare.audioCodec||L.audioCodec,getVideoCodec:()=>t().screenshare.videoCodec||L.videoCodec,getKeyframeInterval:()=>x(t().screenshare.keyframeInterval),getAudioSource:()=>t().screenshare.audioSource},customSet:n=>{e(r=>B(r,n(r)||r))}}),{name:"BetterScreensharePlugin",storage:Fe(()=>At),merge:(e,t)=>B(t,e)})),de=e=>A.createElement(Xe,e),P=e=>A.createElement(Re,{...e,...e.size?{size:Ze[e.size]}:{}}),{h5:bt}=et,he=re.getMediaEngine(),F=e=>BdApi.React.createElement("div",{style:{width:"100%"}},BdApi.React.createElement("h1",{style:{marginTop:"12px",marginBottom:"8px"},className:[bt].join(" ")},e.title),BdApi.React.createElement("div",{style:{width:"100%",display:"flex",gap:"6px"}},...e.settingElements.map(t=>BdApi.React.createElement("div",{style:{flex:"1 1 0"}},t)))),wt=()=>{const{audioSource:e,audioCodec:t,videoCodec:n,bitrate:r,capture:o,encode:s,keyframeInterval:d,setAudioCodec:m,setVideoCodec:v,setAudioSource:l,setKeyframeInterval:f}=je(i=>i.screenshare),[c,p]=A.useState(),[h,g]=A.useState();A.useEffect(()=>{const i=setInterval(async()=>{g(await he.getWindowPreviews(1,1))},2e3);return()=>clearInterval(i)},[]),A.useEffect(()=>{(async()=>{const i=JSON.parse(await new Promise(O=>he.getCodecCapabilities(O)));p(i),g(await he.getWindowPreviews(1,1))})()},[]),A.useEffect(()=>{h&&(h.some(i=>!e||[i.id,"none","default"].includes(e))||l(void 0))},[h]);const u={title:"Capture",settingElements:[BdApi.React.createElement(P,{placeholder:"Width",type:"number",value:o.width,onChange:i=>T(i,o.setWidth)}),BdApi.React.createElement(P,{placeholder:"Height",type:"number",value:o.height,onChange:i=>T(i,o.setHeight)}),BdApi.React.createElement(P,{placeholder:"Framerate",type:"number",value:o.framerate,onChange:i=>T(i,o.setFramerate)})]},a={title:"Encode",settingElements:[BdApi.React.createElement(P,{placeholder:"Width",type:"number",value:s.width,onChange:i=>T(i,s.setWidth)}),BdApi.React.createElement(P,{placeholder:"Height",type:"number",value:s.height,onChange:i=>T(i,s.setHeight)}),BdApi.React.createElement(P,{placeholder:"Framerate",type:"number",value:s.framerate,onChange:i=>T(i,s.setFramerate)})]},S={title:"Bitrate",settingElements:[BdApi.React.createElement(P,{placeholder:"Minimum",type:"number",value:r.minimum,onChange:i=>T(i,r.setMinimum)}),BdApi.React.createElement(P,{placeholder:"Target",type:"number",value:r.target,onChange:i=>T(i,r.setTarget)}),BdApi.React.createElement(P,{placeholder:"Maximum",type:"number",value:r.maximum,onChange:i=>T(i,r.setMaximum)})]},_={title:"Keyframe Interval",settingElements:[BdApi.React.createElement(P,{placeholder:"Interval",type:"number",value:d,onChange:i=>T(i,f)})]},y={title:"Video Codec",settingElements:[BdApi.React.createElement(de,{options:[...c?c.map(i=>({label:`${i.codec}${i.encode?"":" (Unsupported)"}`,value:i.codec})):[]],onChange:i=>v(i),value:n||"H264"})]},E={title:"Audio Codec",settingElements:[BdApi.React.createElement(de,{options:[{label:"OPUS",value:"OPUS"}],onChange:i=>m(i),value:t||"OPUS"})]},b={title:"Audio Source",settingElements:[BdApi.React.createElement(de,{options:[{label:"Default",value:"default"},{label:"None",value:"none"},...h?h.map(({id:i,name:O})=>({label:O,value:i})):[]],onChange:i=>l(i),value:e||"default"})]};return BdApi.React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"5px"}},BdApi.React.createElement(F,{...u}),BdApi.React.createElement(F,{...a}),BdApi.React.createElement(F,{...S}),BdApi.React.createElement("div",{style:{display:"flex",gap:"6px"}},BdApi.React.createElement(F,{...E}),BdApi.React.createElement(F,{...y}),BdApi.React.createElement(F,{..._})),BdApi.React.createElement(F,{...b}))},pe=class{static patch(){this.unpatch();const t=k.addListener(this.mediaEngine.emitter,"on","connection",r=>{if(r.context!=="stream")return;const o=()=>{const{getAudioCodec:s,getAudioSource:d,getKeyframeInterval:m,getVideoCodec:v,encode:l,capture:f,bitrate:c}=B(L,je.getState().screenshare);r.setCodecs(s(),v(),"stream"),r.setDesktopEncodingOptions(l.getWidth(),l.getHeight(),l.getFramerate()),r.overwriteQualityForTesting({encode:{framerate:l.getFramerate(),width:l.getWidth(),height:l.getHeight()},capture:{framerate:f.getFramerate(),width:f.getWidth(),height:f.getHeight()},bitrateMax:le(c.getMaximum()),bitrateMin:le(c.getMinimum()),bitrateTarget:le(c.getTarget())});const p=d();if(p==="none")r.setSoundshareSource(0,!1);else if(p&&p!=="default"){const g=tt.getPidFromDesktopSource(p);g&&r.setSoundshareSource(g,!0)}const h=m();h&&r.setKeyframeInterval(h)};r.on("connected",o)}),n=Oe(qe.prototype,"render",r=>{if(r.context.props.page!=="Go Live Modal")return;const o=r.result.props.children,s=r.result._owner.return.return.return.return.return.return.return.memoizedProps,d=s.modalKey,m=s.closeModal;r.result.props.children=v=>{const l=o(v),f=Qe(l,c=>{var p;return((p=c==null?void 0:c.props)==null?void 0:p.type)==="submit"});switch(f!=null&&f.props&&(f.props.onClick=c=>{this.mediaEngine.eachConnection(p=>{if(p.context==="stream"&&p.connectionState==="CONNECTED"){this.mediaEngine.setDesktopSource({id:null});const h=nt.getCurrentUserActiveStream();rt.dispatch({type:"STREAM_STOP",streamKey:`${h.streamType}:${h.guildId?`${h.guildId}:`:""}${h.channelId}:${h.ownerId}`}),m(d)}})}),l.props.value.location.section){case"Stream Settings":const c=l.props.children;c.props.title="Stream Settings",c.props.children.props.children=this.replacedStreamQualityComponent;break}return l}});this.unpatchFunctions.push(t,n)}static unpatch(){this.unpatchFunctions.forEach(t=>t()),this.unpatchFunctions=[]}};let M=pe;R(M,"mediaEngineStore",re),R(M,"mediaEngine",pe.mediaEngineStore.getMediaEngine()),R(M,"replacedStreamQualityComponent",BdApi.React.createElement(wt,null)),R(M,"unpatchFunctions",[]);const fe=class{static patch(t={}){t.mediaEngineStore&&this.unpatchFunctions.push(...$(this.mediaEngineStore,{searchProtos:!0,name:"MediaEngineStore",filter:([n,r])=>!["isSelfDeaf","isSelfMute","isSupported","isDeaf","isEnabled","supports","supportsInApp","getInputDetected","isMute","isHardwareMute","getOpenH264"].includes(n)})),t.mediaEngine&&this.unpatchFunctions.push(...$(this.mediaEngine,{searchProtos:!0,name:"MediaEngine",filter:([n,r])=>!["emit","supports","supported","eachConnection"].includes(n)})),t.connections&&this.unpatchFunctions.push(k.addListener(this.mediaEngine.emitter,"on","connection",n=>{this.unpatchFunctions.push(...$(n,{searchProtos:!0,name:"Connection",filter:([r,o])=>!["emit","handleStats","getStats","emitStats","getStreamParameters","setHasActiveVideoOutputSink","getActiveOutputSinkTrackingEnabled"].includes(r)}))}))}static unpatch(){this.unpatchFunctions.forEach(t=>t()),this.unpatchFunctions=[]}};let H=fe;R(H,"mediaEngineStore",re),R(H,"mediaEngine",fe.mediaEngineStore.getMediaEngine()),R(H,"unpatchFunctions",[]),module.exports=class extends $e{constructor(){super(),We(Je)}async start(){M.patch()}stop(){ke(),H.unpatch(),M.unpatch(),k.removeAllListeners()}}})(BdApi.React);
